let e,t,o={};"production"===envMode?o={ffmpeg:"/javascript/ffmpeg/ffmpeg/index.js",utils:"https://cdn.jsdelivr.net/npm/@ffmpeg/util@0.12.1/dist/esm/index.min.js",mtCore:"https://cdn.jsdelivr.net/npm/@ffmpeg/core-mt@0.12.4/dist/esm/ffmpeg-core.js",mtWasm:"https://cdn.jsdelivr.net/npm/@ffmpeg/core-mt@0.12.4/dist/esm/ffmpeg-core.wasm",mtWorker:"/javascript/ffmpeg/multi-thread/ffmpeg-core.worker.js",stCore:"https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.4/dist/esm/ffmpeg-core.js"}:"development"===envMode&&(o={ffmpeg:"/javascript/ffmpeg/ffmpeg/index.js",utils:"/javascript/ffmpeg/utils/index.js",mtCore:"/javascript/ffmpeg/multi-thread/ffmpeg-core.js",mtWasm:"/javascript/ffmpeg/multi-thread/ffmpeg-core.wasm",mtWorker:"/javascript/ffmpeg/multi-thread/ffmpeg-core.worker.js",stCore:"/javascript/ffmpeg/core/ffmpeg-core.js"}),(async()=>{const{FFmpeg:i}=await import(o.ffmpeg),{fetchFile:n}=await import(o.utils);e=i,t=n,await h()})();let i,n,a=null,l=!1;const u=document.getElementById("videoInput"),s=document.getElementById("outputName"),m=document.getElementById("convertButton"),p=document.getElementById("downloadLink"),c=document.getElementById("mode").textContent;async function r(){console.log("multithreading engaged"),await a.load({coreURL:o.mtCore,wasmURL:o.mtWasm,workerURL:o.mtWorker})}async function d(){console.log("singlethreading engaged"),await a.load({coreURL:o.stCore})}const g=async()=>{null===a&&(a=new e,a.on("log",(({message:e})=>{console.log(e)})),"merge"===c?a.on("progress",(({progress:e,time:t})=>{message.innerHTML=t/1e6+" s"})):a.on("progress",(({progress:e})=>{message.innerHTML=100*e+" %"})),l?await r():await d())};function F(e){const t=[];let o="",i=!1;for(let n=0;n<e.length;n++){const a=e.charAt(n);'"'===a?i=!i:" "!==a||i?o+=a:o&&(t.push(o),o="")}return o&&t.push(o),t}const f=(e,t)=>({conversion:`-i "${e.inputFileName}" "${e.outputFileName}"`,trim:`-ss "${e.start.time}" -i "${e.inputFileName}" -ss "${e.start.time}" -i "${e.inputFileName}" -t ${e.end.time} -map 0:v -map 1:a -c:v copy -c:a copy "${e.outputFileName}"`,merge:`-f concat -safe 0 -i concat_list.txt -c:v copy -c:a copy "${e.outputFileName}"`,split:`-i "${e.inputFileName}" -t ${e.start.time} -c:v copy -c:a copy "${e.outputFileName}" -ss ${e.start.time} -c:v copy -c:a copy "${e.outputFileName2}"`,resize:`-i "${e.inputFileName}" -vf "scale=${e.size},setsar=1:1" ${e.outputFileName}`,removeaudio:`-i "${e.inputFileName}" -c:v copy -an "${e.outputFileName}"`,crop:`-i "${e.inputFileName}" -vf crop=${e.dimension} ${e.outputFileName}`,getaudio:`-i "${e.inputFileName}" "${e.outputFileName}"`,textoverlay:`-i "${e.inputFileName}" -vf drawtext="${e.drawtext}" ${e.outputFileName}`}[t]),v=async(e,o)=>{switch(o){case"conversion":case"trim":case"split":case"removeaudio":case"resize":case"crop":case"getaudio":case"textoverlay":console.log(e.inputFileName),console.log(e.videoFile.name),await a.writeFile(e.inputFileName,await t(e.videoFile));break;case"merge":console.log("Start Concating");const o=[];for(const i of e.videoFile){const{name:e}=i;a.writeFile(e,await t(i)),o.push(`file '${e}'`)}console.log(o),await a.writeFile("concat_list.txt",o.join("\n"));break;default:console.log("path not found")}message.innerHTML="Start transcoding";const i=F(await f(e,o));console.log(i),console.log(i),await a.exec(i),message.innerHTML="transcoding completed"},y=async e=>{const t=await a.readFile(e.outputFileName),o=document.getElementById("output-video"),l=`video/${e.outputFileType}`,u=URL.createObjectURL(new Blob([t.buffer],{type:l}));if(o.src=u,i&&URL.revokeObjectURL(i),i=u,p.href=u,p.download=e.outputFileName,p.style.display="block","split"===c){console.log("i am inside split");const t=await a.readFile(e.outputFileName2),o=URL.createObjectURL(new Blob([t.buffer],{type:l}));n&&URL.revokeObjectURL(n),n=o;var s=document.getElementById("downloadLink2");s.href=o,s.download=e.outputFileName2,s.style.display="block"}o.classList.contains("hidden")&&o.classList.toggle("hidden")};function $(e,t){const o=e.split(":").map(Number),i=t.split(":").map(Number),n=3600*o[0]+60*o[1]+o[2],a=3600*i[0]+60*i[1]+i[2]-n,l=Math.floor(a/3600),u=Math.floor(a%3600/60),s=a%60;return`${l.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}async function N(){l=!l,console.log(`is multithreaded = ${l}`),l?await r():await d()}async function h(){console.log("loading ffmpeg"),await g()}m.addEventListener("click",(async()=>{if(!u.files.length||!s.value)return void alert("Please select a video and provide an output name.");document.getElementById("message");var e={videoFile:u.files[0],inputFileName:"",outputFileN:document.getElementById("outputName").value,outputFileType:"",outputFileName:"",outputFileName2:"",start:{hour:0,minute:0,second:0},end:{hour:0,minute:0,second:0},duration:"",size:"",dimension:"",audioinput:"",drawtext:""};switch(console.log("before switch for input mode"),c){case"conversion":case"getaudio":e.outputFileType=document.getElementById("outputFormat").value,e.inputFileName=e.videoFile.name,e.outputFileName=`${e.outputFileN}.${e.outputFileType}`;break;case"trim":e.inputFileName=e.videoFile.name,e.outputFileType=e.inputFileName.split(".").pop(),e.outputFileName=`${e.outputFileN}.${e.outputFileType}`,e.start={hour:document.getElementById("start_hour").value,minute:document.getElementById("start_minute").value,second:document.getElementById("start_second").value},e.end={hour:document.getElementById("end_hour").value,minute:document.getElementById("end_minute").value,second:document.getElementById("end_second").value},e.start.time=`${e.start.hour}:${e.start.minute}:${e.start.second}`,e.end.time=`${e.start.hour}:${e.end.minute}:${e.end.second}`,console.log(`Duration: ${e.end.time}`),console.log(`Duration: ${e.start.time}`),e.end.time=$(e.start.time,e.end.time),console.log(`Duration: ${e.end.time}`);break;case"merge":console.log("merging - input"),e.videoFile=u.files,console.log(e.videoFile),e.inputFileName=e.videoFile[0].name,e.outputFileType=e.inputFileName.split(".").pop(),e.outputFileName=`${e.outputFileN}.${e.outputFileType}`;const o=e.inputFileName.split(".").pop();for(var t of e.videoFile)if(t.name.split(".").pop()!=o)return void alert("input files must be of the same type");break;case"split":e.inputFileName=e.videoFile.name,e.outputFileType=e.inputFileName.split(".").pop(),e.outputFileName=`${e.outputFileN}p1.${e.outputFileType}`,e.outputFileName2=`${e.outputFileN}p2.${e.outputFileType}`,e.start={hour:document.getElementById("start_hour").value,minute:document.getElementById("start_minute").value,second:document.getElementById("start_second").value},e.start.time=`${e.start.hour}:${e.start.minute}:${e.start.second}`;break;case"resize":e.inputFileName=e.videoFile.name,e.outputFileType=e.inputFileName.split(".").pop(),e.outputFileName=`${e.outputFileN}.${e.outputFileType}`,e.size=document.getElementById("dimension").value;break;case"removeaudio":e.inputFileName=e.videoFile.name,e.outputFileType=e.inputFileName.split(".").pop(),e.outputFileName=`${e.outputFileN}.${e.outputFileType}`;break;case"crop":e.inputFileName=e.videoFile.name,e.outputFileType=e.inputFileName.split(".").pop(),e.outputFileName=`${e.outputFileN}.${e.outputFileType}`,e.dimension=`${document.getElementById("width").value}:${document.getElementById("height").value}:${document.getElementById("x").value}:${document.getElementById("y").value}`,console.log(e.dimension);break;case"textoverlay":e.inputFileName=e.videoFile.name,e.outputFileType=e.inputFileName.split(".").pop(),e.outputFileName=`${e.outputFileN}.${e.outputFileType}`,e.drawtext=`text='${document.getElementById("text").value}':x=${document.getElementById("x").value}:y=${document.getElementById("y").value}:fontsize=${document.getElementById("fontsize").value}`,console.log(` The created drawtext ${e.drawtext}`);break;default:console.log("path not found")}console.log("2"),await v(e,c),console.log("3"),y(e),console.log("4")}));const w=document.getElementById("input-video");u.addEventListener("change",(function(e){const t=e.target.files[0];if(t){console.log("File selected:",t.name);var o=URL.createObjectURL(t);w.src=o,w.classList.contains("hidden")&&w.classList.toggle("hidden")}else console.log("No file selected.")}));