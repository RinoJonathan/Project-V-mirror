const e="production";let t,o,i={};i={ffmpeg:"/javascript/ffmpeg/ffmpeg/index.js",utils:"https://cdn.jsdelivr.net/npm/@ffmpeg/util@0.12.1/dist/esm/index.min.js",mtCore:"https://cdn.jsdelivr.net/npm/@ffmpeg/core-mt@0.12.4/dist/esm/ffmpeg-core.js",mtWasm:"https://cdn.jsdelivr.net/npm/@ffmpeg/core-mt@0.12.4/dist/esm/ffmpeg-core.wasm",mtWorker:"/javascript/ffmpeg/multi-thread/ffmpeg-core.worker.js",stCore:"https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.4/dist/esm/ffmpeg-core.js"},(async()=>{const{FFmpeg:e}=await import(i.ffmpeg),{fetchFile:n}=await import(i.utils);t=e,o=n,await B()})();let n,a,l=null,u=!1;const s=document.getElementById("videoInput"),m=document.getElementById("outputName"),p=document.getElementById("convertButton"),c=document.getElementById("downloadLink"),d=document.getElementById("mode").textContent;async function r(){console.log("multithreading engaged"),await l.load({coreURL:i.mtCore,wasmURL:i.mtWasm,workerURL:i.mtWorker})}async function g(){console.log("singlethreading engaged"),await l.load({coreURL:i.stCore})}const F=async()=>{null===l&&(l=new t,l.on("log",(({message:e})=>{console.log(e)})),"merge"===d?l.on("progress",(({progress:e,time:t})=>{message.innerHTML=t/1e6+" s"})):l.on("progress",(({progress:e})=>{message.innerHTML=100*e+" %"})),u?await r():await g())};function y(e){const t=[];let o="",i=!1;for(let n=0;n<e.length;n++){const a=e.charAt(n);'"'===a?i=!i:" "!==a||i?o+=a:o&&(t.push(o),o="")}return o&&t.push(o),t}const v=(e,t)=>({conversion:`-i "${e.inputFileName}" "${e.outputFileName}"`,trim:`-ss "${e.start.time}" -i "${e.inputFileName}" -ss "${e.start.time}" -i "${e.inputFileName}" -t ${e.end.time} -map 0:v -map 1:a -c:v copy -c:a copy "${e.outputFileName}"`,merge:`-f concat -safe 0 -i concat_list.txt -c:v copy -c:a copy "${e.outputFileName}"`,split:`-i "${e.inputFileName}" -t ${e.start.time} -c:v copy -c:a copy "${e.outputFileName}" -ss ${e.start.time} -c:v copy -c:a copy "${e.outputFileName2}"`,resize:`-i "${e.inputFileName}" -vf "scale=${e.size},setsar=1:1" ${e.outputFileName}`,removeaudio:`-i "${e.inputFileName}" -c:v copy -an "${e.outputFileName}"`,crop:`-i "${e.inputFileName}" -vf crop=${e.dimension} ${e.outputFileName}`,getaudio:`-i "${e.inputFileName}" "${e.outputFileName}"`,textoverlay:`-i "${e.inputFileName}" -vf drawtext="${e.drawtext}" ${e.outputFileName}`}[t]),f=async(e,t)=>{switch(t){case"conversion":case"trim":case"split":case"removeaudio":case"resize":case"crop":case"getaudio":case"textoverlay":console.log(e.inputFileName),console.log(e.videoFile.name),await l.writeFile(e.inputFileName,await o(e.videoFile));break;case"merge":console.log("Start Concating");const t=[];for(const i of e.videoFile){const{name:e}=i;l.writeFile(e,await o(i)),t.push(`file '${e}'`)}console.log(t),await l.writeFile("concat_list.txt",t.join("\n"));break;default:console.log("path not found")}message.innerHTML="Start transcoding";const i=y(await v(e,t));console.log(i),console.log(i),await l.exec(i),message.innerHTML="transcoding completed"},$=async e=>{const t=await l.readFile(e.outputFileName),o=document.getElementById("output-video"),i=`video/${e.outputFileType}`,u=URL.createObjectURL(new Blob([t.buffer],{type:i}));if(o.src=u,n&&URL.revokeObjectURL(n),n=u,c.href=u,c.download=e.outputFileName,c.style.display="block","split"===d){console.log("i am inside split");const t=await l.readFile(e.outputFileName2),o=URL.createObjectURL(new Blob([t.buffer],{type:i}));a&&URL.revokeObjectURL(a),a=o;var s=document.getElementById("downloadLink2");s.href=o,s.download=e.outputFileName2,s.style.display="block"}o.classList.contains("hidden")&&o.classList.toggle("hidden")};function N(e,t){const o=e.split(":").map(Number),i=t.split(":").map(Number),n=3600*o[0]+60*o[1]+o[2],a=3600*i[0]+60*i[1]+i[2]-n,l=Math.floor(a/3600),u=Math.floor(a%3600/60),s=a%60;return`${l.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}async function h(){u=!u,console.log(`is multithreaded = ${u}`),u?await r():await g()}const w=document.getElementById("toggleModeButton");async function B(){console.log("loading ffmpeg"),await F()}w.addEventListener("click",h),p.addEventListener("click",(async()=>{if(!s.files.length||!m.value)return void alert("Please select a video and provide an output name.");document.getElementById("message");var e={videoFile:s.files[0],inputFileName:"",outputFileN:document.getElementById("outputName").value,outputFileType:"",outputFileName:"",outputFileName2:"",start:{hour:0,minute:0,second:0},end:{hour:0,minute:0,second:0},duration:"",size:"",dimension:"",audioinput:"",drawtext:""};switch(console.log("before switch for input mode"),d){case"conversion":case"getaudio":e.outputFileType=document.getElementById("outputFormat").value,e.inputFileName=e.videoFile.name,e.outputFileName=`${e.outputFileN}.${e.outputFileType}`;break;case"trim":e.inputFileName=e.videoFile.name,e.outputFileType=e.inputFileName.split(".").pop(),e.outputFileName=`${e.outputFileN}.${e.outputFileType}`,e.start={hour:document.getElementById("start_hour").value,minute:document.getElementById("start_minute").value,second:document.getElementById("start_second").value},e.end={hour:document.getElementById("end_hour").value,minute:document.getElementById("end_minute").value,second:document.getElementById("end_second").value},e.start.time=`${e.start.hour}:${e.start.minute}:${e.start.second}`,e.end.time=`${e.start.hour}:${e.end.minute}:${e.end.second}`,console.log(`Duration: ${e.end.time}`),console.log(`Duration: ${e.start.time}`),e.end.time=N(e.start.time,e.end.time),console.log(`Duration: ${e.end.time}`);break;case"merge":console.log("merging - input"),e.videoFile=s.files,console.log(e.videoFile),e.inputFileName=e.videoFile[0].name,e.outputFileType=e.inputFileName.split(".").pop(),e.outputFileName=`${e.outputFileN}.${e.outputFileType}`;const o=e.inputFileName.split(".").pop();for(var t of e.videoFile)if(t.name.split(".").pop()!=o)return void alert("input files must be of the same type");break;case"split":e.inputFileName=e.videoFile.name,e.outputFileType=e.inputFileName.split(".").pop(),e.outputFileName=`${e.outputFileN}p1.${e.outputFileType}`,e.outputFileName2=`${e.outputFileN}p2.${e.outputFileType}`,e.start={hour:document.getElementById("start_hour").value,minute:document.getElementById("start_minute").value,second:document.getElementById("start_second").value},e.start.time=`${e.start.hour}:${e.start.minute}:${e.start.second}`;break;case"resize":e.inputFileName=e.videoFile.name,e.outputFileType=e.inputFileName.split(".").pop(),e.outputFileName=`${e.outputFileN}.${e.outputFileType}`,e.size=document.getElementById("dimension").value;break;case"removeaudio":e.inputFileName=e.videoFile.name,e.outputFileType=e.inputFileName.split(".").pop(),e.outputFileName=`${e.outputFileN}.${e.outputFileType}`;break;case"crop":e.inputFileName=e.videoFile.name,e.outputFileType=e.inputFileName.split(".").pop(),e.outputFileName=`${e.outputFileN}.${e.outputFileType}`,e.dimension=`${document.getElementById("width").value}:${document.getElementById("height").value}:${document.getElementById("x").value}:${document.getElementById("y").value}`,console.log(e.dimension);break;case"textoverlay":e.inputFileName=e.videoFile.name,e.outputFileType=e.inputFileName.split(".").pop(),e.outputFileName=`${e.outputFileN}.${e.outputFileType}`,e.drawtext=`text='${document.getElementById("text").value}':x=${document.getElementById("x").value}:y=${document.getElementById("y").value}:fontsize=${document.getElementById("fontsize").value}`,console.log(` The created drawtext ${e.drawtext}`);break;default:console.log("path not found")}console.log("2"),await f(e,d),console.log("3"),$(e),console.log("4")}));const E=document.getElementById("input-video");s.addEventListener("change",(function(e){const t=e.target.files[0];if(t){console.log("File selected:",t.name);var o=URL.createObjectURL(t);E.src=o,E.classList.contains("hidden")&&E.classList.toggle("hidden")}else console.log("No file selected.")}));